{
  "schema_version": "state_object_v0.4",
  "date": "2026-02-05",
  "repo": {
    "name": "Standivarius/AiGov-monorepo",
    "default_branch_source_of_truth": "main"
  },
  "scope": {
    "in_scope": [
      "GDPR-only alpha (MVP)"
    ],
    "out_of_scope": [
      "Non-GDPR frameworks unless explicitly requested"
    ]
  },
  "hard_rules": {
    "workflow": [
      "Do not execute code in planning chats; output paste-ready Codex prompts.",
      "Always separate TO DOS vs SUGGESTIONS.",
      "Always label effort: low / medium / high / xhigh.",
      "Prompts must be single-outcome.",
      "Each PR must include a PR body with Summary + Testing (audit-friendly).",
      "Keep PRs small; split if >6 files.",
      "PR-gate must remain fast/deterministic; allowed verification commands only: python3 tools/validate_planning_pack.py; bash tools/run_pr_gate_validators.sh; NX_DAEMON=false npx nx run evalsets:migration-smoke.",
      "Prefer adding checks under tools/validate_planning_pack.py rather than wiring new things into tools/run_pr_gate_validators.sh unless strictly necessary.",
      "Be explicit about schema vs policy; validators may enforce policy beyond schema.",
      "Do not invent new schema fields; add a contract/schema PR first if needed.",
      "Use Nx tooling deterministically; set NX_DAEMON=false for nx commands in PR-gate contexts."
    ],
    "review_policy": [
      "End of each PR: run Codex PR review prompt (read-only) and merge only when required checks are green.",
      "End-of-milestone reviews: (1) Claude architecture pass (propose-only), (2) Gemini safety/drift pass (propose-only), (3) Codex xhigh integrity pass running only allowed verification commands."
    ]
  },
  "milestones": [
    {
      "name": "Module Specs + Dashboard v0.1",
      "status": "done",
      "what_changed": [
        "Introduced machine-readable module cards (contract + schema + validator) and a module registry.",
        "Added deterministic human-facing dashboard generator (M_Dashboard.md) from module cards and wired snapshot validation into tools/validate_planning_pack.py.",
        "Added repo hygiene to avoid committing local run artifacts (outputs/logs/venvs)."
      ],
      "why": "Make module boundaries/knobs/contracts auditable and reduce drift; keep PR-gate deterministic."
    },
    {
      "name": "T_Gate v0.1 (tests/evalsets dashboard)",
      "status": "done",
      "what_changed": [
        "Added a single doc/report surface describing what checks/evalsets exist and how to run them (PE/EP 'tests dashboard' concept)."
      ],
      "why": "Reduce confusion about what 'green' means; centralize integrity checks."
    },
    {
      "name": "Runpack v0.1 (Inspect/Petri command printer)",
      "status": "done",
      "what_changed": [
        "Added deterministic tool to print full Inspect command for petri/audit from seed_instructions JSON.",
        "Added validator to ensure deterministic output and fixture match; wired into tools/validate_planning_pack.py.",
        "Hardened shell quoting using stdlib shlex and added edge-case fixtures to catch apostrophes/quotes/backslashes."
      ],
      "why": "Operator-friendly, deterministic run commands without executing runs in tooling; fail-closed and auditable."
    },
    {
      "name": "Client intake cross-field constraints documentation",
      "status": "done",
      "what_changed": [
        "Documented that JSON Schema draft-07 cannot express certain cross-field constraints, which are enforced by tools/validate_client_intake_v0_2.py.",
        "Documented tamper-detection coverage via poison bundle fixture in T_Gate docs."
      ],
      "why": "Close schema-vs-validator contract gaps for enterprise/auditor clarity."
    },
    {
      "name": "Migration-smoke judge smoke skip ambiguity elimination",
      "status": "done",
      "what_changed": [
        "Ensured PE venv bin directory is on PATH when running pytest in tools/run-evalset-migration-smoke.sh (PR110).",
        "Made PE judge smoke fail-closed when AIGOV_RUN_EP_SMOKE is truthy but aigov-ep is missing (PR110).",
        "Migration-smoke now passes with 0 skipped when EP smoke is requested (confirmed on main)."
      ],
      "why": "Remove false confidence from 'skipped' smoke checks; keep PR-gate deterministic."
    },
    {
      "name": "Deterministic bundle manifest consumption in EP execute",
      "status": "done",
      "what_changed": [
        "EP execute prefers bundle_dir/manifest.json (schema_version 0.1.0) with sha256 verification; legacy bundle_manifest.json remains supported as policy-only fallback (PR112).",
        "Added tools/validate_ep_deterministic_bundle_manifest.py and wired into tools/validate_planning_pack.py (PR112)."
      ],
      "why": "Fail-closed execution inputs with cryptographic integrity; deterministic scenario selection."
    },
    {
      "name": "Interface Ledger v0 + validator",
      "status": "done",
      "what_changed": [
        "Introduced packages/specs/docs/contracts/interfaces/I_Ledger.md as GDPR-only interface edge map (PR119/120 series).",
        "Added tools/validate_interface_ledger.py and wired into tools/validate_planning_pack.py to prevent drift (PR119/120)."
      ],
      "why": "Single auditable map of module interfaces; keep doc structure stable and validated."
    },
    {
      "name": "Dataset JSONL v0.1 contract + validator (GDPR-only)",
      "status": "done",
      "what_changed": [
        "Added aigov_dataset_jsonl_v0_1 schema + stdlib validator + pass/fail fixtures; wired into tools/validate_planning_pack.py (PR125 + follow-ups).",
        "Hardened validator to enforce minLength (non-empty IDs/seed_instructions items) and added dedicated fail fixtures (post-review hardening)."
      ],
      "why": "Deterministic, fail-closed dataset artifact format for evaluation/execution pipelines."
    },
    {
      "name": "Intake Output Context Stack v0.1 (NL + sector packs)",
      "status": "done",
      "what_changed": [
        "Added taxonomy allowlists for jurisdictions/sectors/policy packs and defined context_profile semantics in Intake OUTPUT contract (PR-A/129 series).",
        "EP intake output validator enforces allowlists and exact policy_pack_stack ordering; derives context_profile from legacy locale_context when needed (PR129).",
        "PE tests add parity coverage (PR130).",
        "Hardening: fail-closed when locale_context is present but null/empty; added PR-gate fail fixtures for null/unknown jurisdiction/unknown sector (PR132).",
        "Docs: M_Intake module card + Interface Ledger row updated without over-claiming validators (PR131)."
      ],
      "why": "Contract-first, scalable modeling of baseline+locale+sector+client context; deterministic provenance via ordered stack."
    }
  ],
  "key_repo_artifacts": {
    "module_cards": {
      "registry_path": "packages/specs/docs/contracts/modules/module_registry_v0.yaml",
      "cards_dir": "packages/specs/docs/contracts/modules/cards/",
      "schema_path": "packages/specs/schemas/module_card_v0.schema.json",
      "dashboard_snapshot_path": "packages/specs/docs/contracts/modules/M_Dashboard.md",
      "dashboard_exporter": "tools/export_module_cards_dashboard.py",
      "validator": "tools/validate_module_cards.py"
    },
    "tests_dashboard": {
      "t_gate_doc_path": "packages/specs/docs/contracts/tests/T_Gate.md",
      "t_gate_reporter_path": "tools/report_t_gate_status.py"
    },
    "runpack": {
      "command_printer": "tools/print_inspect_petri_run_command.py",
      "validator": "tools/validate_print_inspect_petri_run_command.py",
      "fixtures_dir": "tools/fixtures/runpack/"
    },
    "planning_pack_gate": {
      "validator_path": "tools/validate_planning_pack.py",
      "allowed_commands": [
        "python3 tools/validate_planning_pack.py",
        "bash tools/run_pr_gate_validators.sh",
        "NX_DAEMON=false npx nx run evalsets:migration-smoke"
      ]
    },
    "interface_ledger": {
      "ledger_path": "packages/specs/docs/contracts/interfaces/I_Ledger.md",
      "validator": "tools/validate_interface_ledger.py"
    },
    "deterministic_bundle_manifest": {
      "ep_loader": "packages/ep/aigov_ep/scenario/bundle_manifest_v0_1_0.py",
      "ep_cli": "packages/ep/aigov_ep/cli.py",
      "validator": "tools/validate_ep_deterministic_bundle_manifest.py"
    },
    "dataset_jsonl_v0_1": {
      "schema_path": "packages/specs/schemas/aigov_dataset_jsonl_v0_1.schema.json",
      "validator": "tools/validate_aigov_dataset_jsonl_v0_1.py",
      "fixtures_dir": "tools/fixtures/validators/"
    },
    "intake_output_context_stack": {
      "contract_doc": "packages/specs/docs/contracts/intake/client_intake_output_contract_v0_1.md",
      "taxonomy_allowlists": [
        "packages/specs/docs/contracts/taxonomy/jurisdictions_v0.json",
        "packages/specs/docs/contracts/taxonomy/sectors_v0.json",
        "packages/specs/docs/contracts/taxonomy/policy_packs_v0.json"
      ],
      "ep_validator": "packages/ep/aigov_ep/intake/validate.py",
      "pe_tests": "packages/pe/tests/intake/test_intake_validation.py",
      "planning_pack_gate": "tools/validate_planning_pack.py"
    }
  },
  "reviews": {
    "codex_xhigh_latest": {
      "verdict": "APPROVE (merged PR132 hardening)",
      "notes": [
        "PR-gate remains deterministic; intake context stack fixtures added for null locale_context + unknown jurisdiction/sector.",
        "Allowed verification: python3 tools/validate_planning_pack.py PASS."
      ]
    },
    "claude_latest": {
      "verdict": "APPROVE (Intake context stack PR129â€“131)",
      "notes": [
        "Confirmed allowlists, strict stack ordering, legacy derivation, and docs accuracy (schema vs policy clearly labeled).",
        "Suggested adding PR-gate fixtures for unknown jurisdiction/sector (implemented in PR132)."
      ]
    },
    "gemini_latest": {
      "verdict": "REQUEST CHANGES then RESOLVED (PR132)",
      "notes": [
        "Found fail-open edge: locale_context:null could pass without context_profile.",
        "Resolved by PR132: locale_context present but null/empty fails closed; PR-gate fixtures added."
      ]
    }
  },
  "open_risks_and_mitigations": [
    {
      "risk": "Shell quoting/injection in printed run commands",
      "status": "mitigated",
      "mitigation": "Use shlex.quote + enforce edge-case fixtures with apostrophes/quotes/backslashes in runpack validator (PR109)."
    },
    {
      "risk": "Ambiguous 'skipped' in migration-smoke judge smoke leading to false confidence",
      "status": "mitigated",
      "mitigation": "tools/run-evalset-migration-smoke.sh ensures venv bin on PATH; judge smoke fails closed when EP smoke requested but aigov-ep missing (PR110)."
    },
    {
      "risk": "Intake OUTPUT context stack fail-open on null locale_context",
      "status": "mitigated",
      "mitigation": "EP intake validator fails closed when locale_context is present but null/empty; PR-gate fixtures assert failure (PR132)."
    },
    {
      "risk": "Module taxonomy / naming drift across module cards, ledger, and code references",
      "status": "open",
      "mitigation_plan": "Define and enforce a minimal module taxonomy consistency check (report + validator) so renamed/added modules cannot drift across registry/cards/ledger. Keep deterministic and PR-gate friendly."
    }
  ],
  "next_steps": [
    {
      "id": "END_MILESTONE_CHECK",
      "title": "Run end-of-sprint comprehensive tests (after PR132)",
      "effort": "low",
      "single_outcome": "Confirm repo integrity after Intake context stack hardening using only allowed commands.",
      "verification_commands": [
        "python3 tools/validate_planning_pack.py",
        "bash tools/run_pr_gate_validators.sh",
        "NX_DAEMON=false npx nx run evalsets:migration-smoke"
      ]
    },
    {
      "id": "MILESTONE_M_LIVERUN_DEFINITION",
      "title": "Milestone: Define M_LiveRun end-to-end interfaces and outputs (GDPR-only)",
      "effort": "high",
      "single_outcome": "Make M_LiveRun concrete: contracts + module card + interface ledger edges + deterministic artifacts, without executing runs in tooling.",
      "stop_conditions": [
        "Do not introduce non-GDPR frameworks unless explicitly requested.",
        "Do not add new PR-gate commands beyond the allowed list."
      ]
    },
    {
      "id": "PR_NEXT_MODULE_TAXONOMY_CHECK",
      "title": "Repo-wide module taxonomy consistency check",
      "effort": "medium",
      "single_outcome": "Add a deterministic reporter/validator that detects module naming drift between registry, module cards, and Interface Ledger (fail-closed, minimal policy).",
      "verification_commands": [
        "python3 tools/validate_planning_pack.py"
      ]
    }
  ],
  "handoff": {
    "transcript_to_save": "2026-02-05_GDPR_Execution_Planning.md",
    "recommended_repo_paths": {
      "state_object": "packages/specs/docs/planning/2026-02-05/state_object_v0_4__2026-02-05.json",
      "chat_transcript": "packages/specs/docs/artifacts/2026-02-05_GDPR_Execution_Planning.md"
    }
  }
}
